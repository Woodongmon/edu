/*
 * motor.c
 *
 *  Created on: Oct 28, 2025
 *      Author: user21
 */

#include "motor.h"



void MOTOR_Init()
{
	HAL_GPIO_WritePin(IN1_GPIO_PORT, IN1_PIN, 0);
	HAL_GPIO_WritePin(IN2_GPIO_PORT, IN2_PIN, 0);
	HAL_GPIO_WritePin(IN3_GPIO_PORT, IN3_PIN, 0);
	HAL_GPIO_WritePin(IN4_GPIO_PORT, IN4_PIN, 0);

	MX_TIM2_Init();  // pwm사용을 위한 초기 init
    HAL_TIM_PWM_Start(&htim2, TIM_CHANNEL_1);  // ENA (PA0)
    HAL_TIM_PWM_Start(&htim2, TIM_CHANNEL_2);  // ENB (PA1)

}

void FOWARD()
{
	HAL_GPIO_WritePin(IN1_GPIO_PORT, IN1_PIN, 1);
	HAL_GPIO_WritePin(IN2_GPIO_PORT, IN2_PIN, 0);
	HAL_GPIO_WritePin(IN3_GPIO_PORT, IN3_PIN, 1);
	HAL_GPIO_WritePin(IN4_GPIO_PORT, IN4_PIN, 0);
}

void BACKWARD()
{
	HAL_GPIO_WritePin(IN1_GPIO_PORT, IN1_PIN, 0);
	HAL_GPIO_WritePin(IN2_GPIO_PORT, IN2_PIN, 1);
	HAL_GPIO_WritePin(IN3_GPIO_PORT, IN3_PIN, 0);
	HAL_GPIO_WritePin(IN4_GPIO_PORT, IN4_PIN, 1);
}


//EN Pin - on/off,direction control
//void GEAR();

void MAX()
{
	HAL_GPIO_WritePin(ENA_GPIO_PORT, ENA_PIN, 1);
	HAL_GPIO_WritePin(ENB_GPIO_PORT, ENB_PIN, 1);
}

void OFF()
{
	HAL_GPIO_WritePin(ENA_GPIO_PORT, ENA_PIN, 0);
	HAL_GPIO_WritePin(ENB_GPIO_PORT, ENB_PIN, 0);
}

void LEFT()
{
	HAL_GPIO_WritePin(ENA_GPIO_PORT, ENA_PIN, 0);
	HAL_GPIO_WritePin(ENB_GPIO_PORT, ENB_PIN, 1);
}

void RIGHT()
{
	HAL_GPIO_WritePin(ENA_GPIO_PORT, ENA_PIN, 1);
	HAL_GPIO_WritePin(ENB_GPIO_PORT, ENB_PIN, 0);
}

void Motortest()
{


	FOWARD();

	MAX();
	HAL_Delay(1000);
	OFF();
	HAL_Delay(1000);

	LEFT();
	HAL_Delay(1000);
	OFF();
	HAL_Delay(1000);

	RIGHT();
	HAL_Delay(1000);
	OFF();
	HAL_Delay(1000);

	BACKWARD();

	MAX();
	HAL_Delay(1000);
	OFF();
	HAL_Delay(1000);

	LEFT();
	HAL_Delay(1000);
	OFF();
	HAL_Delay(1000);

	RIGHT();
	HAL_Delay(1000);
	OFF();
	HAL_Delay(1000);


}
